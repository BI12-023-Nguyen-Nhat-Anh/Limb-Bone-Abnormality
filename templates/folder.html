{% extends 'home.html' %}
{% block title %}Folder{% endblock %}
{% block content %}
<link rel="stylesheet" href="../static/folder.css">
  <div class="form">

    <div class="step">
      <div class="step-1">
        <svg xmlns="http://www.w3.org/2000/svg" width="276" height="60" viewBox="0 0 276 60" fill="none">
          <g filter="url(#filter0_d_302_314)">
            <mask id="path-1-inside-1_302_314" fill="white">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M2 5C2 2.79086 3.79086 1 6 1H255.679C257.114 1 258.44 1.76914 259.152 3.01544L272.866 27.0154C273.569 28.2452 273.569 29.7548 272.866 30.9846L259.152 54.9846C258.44 56.2309 257.114 57 255.679 57H6C3.79086 57 2 55.2091 2 53V5Z"/>
            </mask>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M2 5C2 2.79086 3.79086 1 6 1H255.679C257.114 1 258.44 1.76914 259.152 3.01544L272.866 27.0154C273.569 28.2452 273.569 29.7548 272.866 30.9846L259.152 54.9846C258.44 56.2309 257.114 57 255.679 57H6C3.79086 57 2 55.2091 2 53V5Z" fill="white"/>
            <path d="M272.866 27.0154L273.734 26.5193V26.5193L272.866 27.0154ZM272.866 30.9846L273.734 31.4807V31.4807L272.866 30.9846ZM259.152 54.9846L260.02 55.4807L259.152 54.9846ZM259.152 3.01544L260.02 2.51931L259.152 3.01544ZM255.679 0H6V2H255.679V0ZM258.283 3.51158L271.998 27.5116L273.734 26.5193L260.02 2.51931L258.283 3.51158ZM271.998 27.5116C272.525 28.4339 272.525 29.5661 271.998 30.4884L273.734 31.4807C274.613 29.9435 274.613 28.0565 273.734 26.5193L271.998 27.5116ZM271.998 30.4884L258.283 54.4884L260.02 55.4807L273.734 31.4807L271.998 30.4884ZM6 58H255.679V56H6V58ZM1 5V53H3V5H1ZM258.283 54.4884C257.749 55.4231 256.755 56 255.679 56V58C257.473 58 259.13 57.0386 260.02 55.4807L258.283 54.4884ZM6 0C3.23858 0 1 2.23858 1 5H3C3 3.34315 4.34315 2 6 2V0ZM6 56C4.34315 56 3 54.6569 3 53H1C1 55.7614 3.23858 58 6 58V56ZM255.679 2C256.755 2 257.749 2.57686 258.283 3.51158L260.02 2.51931C259.13 0.96143 257.473 0 255.679 0V2Z" fill="#CFD8DC" mask="url(#path-1-inside-1_302_314)"/>
          </g>
          <defs>
            <filter id="filter0_d_302_314" x="0" y="0" width="275.393" height="60" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
              <feFlood flood-opacity="0" result="BackgroundImageFix"/>
              <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
              <feOffset dy="1"/>
              <feGaussianBlur stdDeviation="1"/>
              <feColorMatrix type="matrix" values="0 0 0 0 0.215686 0 0 0 0 0.254902 0 0 0 0 0.317647 0 0 0 0.08 0"/>
              <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_302_314"/>
              <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_302_314" result="shape"/>
            </filter>
          </defs>
        </svg>
      </div>
      <div class="step-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="259" height="60" viewBox="0 0 259 60" fill="none">
          <g filter="url(#filter0_d_752_500)">
          <mask id="path-1-inside-1_752_500" fill="white">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M242.618 3.01544C241.906 1.76914 240.581 1 239.145 1H6.35943C3.28814 1 1.36267 4.31793 2.88645 6.98456L14.3327 27.0154C15.0354 28.2452 15.0354 29.7548 14.3327 30.9846L2.88645 51.0154C1.36267 53.6821 3.28814 57 6.35943 57H239.145C240.581 57 241.906 56.2309 242.618 54.9846L256.333 30.9846C257.035 29.7548 257.035 28.2452 256.333 27.0154L242.618 3.01544Z"/>
          </mask>
          <path fill-rule="evenodd" clip-rule="evenodd" d="M242.618 3.01544C241.906 1.76914 240.581 1 239.145 1H6.35943C3.28814 1 1.36267 4.31793 2.88645 6.98456L14.3327 27.0154C15.0354 28.2452 15.0354 29.7548 14.3327 30.9846L2.88645 51.0154C1.36267 53.6821 3.28814 57 6.35943 57H239.145C240.581 57 241.906 56.2309 242.618 54.9846L256.333 30.9846C257.035 29.7548 257.035 28.2452 256.333 27.0154L242.618 3.01544Z" fill="white"/>
          <path d="M14.3327 27.0154L13.4644 27.5116L13.4644 27.5116L14.3327 27.0154ZM14.3327 30.9846L13.4644 30.4884L13.4644 30.4884L14.3327 30.9846ZM256.333 30.9846L257.201 31.4807L257.201 31.4807L256.333 30.9846ZM256.333 27.0154L257.201 26.5193L257.201 26.5193L256.333 27.0154ZM242.618 3.01544L243.487 2.51931L242.618 3.01544ZM242.618 54.9846L243.487 55.4807L242.618 54.9846ZM6.35943 2H239.145V0H6.35943V2ZM15.2009 26.5193L3.7547 6.48842L2.01821 7.4807L13.4644 27.5116L15.2009 26.5193ZM15.2009 31.4807C16.0793 29.9435 16.0793 28.0565 15.2009 26.5193L13.4644 27.5116C13.9915 28.4339 13.9915 29.5661 13.4644 30.4884L15.2009 31.4807ZM3.7547 51.5116L15.2009 31.4807L13.4644 30.4884L2.01821 50.5193L3.7547 51.5116ZM239.145 56H6.35943V58H239.145V56ZM255.464 30.4884L241.75 54.4884L243.487 55.4807L257.201 31.4807L255.464 30.4884ZM255.464 27.5116C255.991 28.4339 255.991 29.5661 255.464 30.4884L257.201 31.4807C258.079 29.9435 258.079 28.0565 257.201 26.5193L255.464 27.5116ZM241.75 3.51158L255.464 27.5116L257.201 26.5193L243.487 2.51931L241.75 3.51158ZM2.01821 50.5193C0.113476 53.8526 2.52032 58 6.35943 58V56C4.05596 56 2.61186 53.5116 3.7547 51.5116L2.01821 50.5193ZM239.145 2C240.222 2 241.216 2.57686 241.75 3.51158L243.487 2.51931C242.596 0.96143 240.94 0 239.145 0V2ZM239.145 58C240.94 58 242.596 57.0386 243.487 55.4807L241.75 54.4884C241.216 55.4231 240.222 56 239.145 56V58ZM6.35943 0C2.52031 0 0.113477 4.14741 2.01821 7.4807L3.7547 6.48842C2.61186 4.48845 4.05596 2 6.35943 2V0Z" fill="#DDDFE1" mask="url(#path-1-inside-1_752_500)"/>
          </g>
          <defs>
          <filter id="filter0_d_752_500" x="0.353516" y="0" width="258.506" height="60" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
          <feFlood flood-opacity="0" result="BackgroundImageFix"/>
          <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
          <feOffset dy="1"/>
          <feGaussianBlur stdDeviation="1"/>
          <feColorMatrix type="matrix" values="0 0 0 0 0.215686 0 0 0 0 0.254902 0 0 0 0 0.317647 0 0 0 0.08 0"/>
          <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_752_500"/>
          <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_752_500" result="shape"/>
          </filter>
          </defs>
          </svg>
      </div>
      <div class="step-3">
        <svg xmlns="http://www.w3.org/2000/svg" width="240" height="56" viewBox="0 0 240 56" fill="none">
          <mask id="path-1-inside-1_752_147" fill="white">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M1.35325 5.98456C-0.170536 3.31793 1.75493 0 4.82623 0H235.934C238.143 0 239.934 1.79086 239.934 4V52C239.934 54.2091 238.143 56 235.934 56H4.82622C1.75493 56 -0.170536 52.6821 1.35325 50.0154L12.7995 29.9846C13.5022 28.7548 13.5022 27.2452 12.7995 26.0154L1.35325 5.98456Z"/>
          </mask>
          <path fill-rule="evenodd" clip-rule="evenodd" d="M1.35325 5.98456C-0.170536 3.31793 1.75493 0 4.82623 0H235.934C238.143 0 239.934 1.79086 239.934 4V52C239.934 54.2091 238.143 56 235.934 56H4.82622C1.75493 56 -0.170536 52.6821 1.35325 50.0154L12.7995 29.9846C13.5022 28.7548 13.5022 27.2452 12.7995 26.0154L1.35325 5.98456Z" fill="white"/>
          <path d="M12.7995 29.9846L11.9312 29.4884L11.9312 29.4884L12.7995 29.9846ZM12.7995 26.0154L11.9312 26.5116L11.9312 26.5116L12.7995 26.0154ZM1.35325 50.0154L0.485007 49.5193L1.35325 50.0154ZM1.35325 5.98456L0.485007 6.48069L1.35325 5.98456ZM235.934 -1H4.82623V1H235.934V-1ZM240.934 52V4H238.934V52H240.934ZM4.82622 57H235.934V55H4.82622V57ZM11.9312 29.4884L0.485007 49.5193L2.22149 50.5116L13.6677 30.4807L11.9312 29.4884ZM11.9312 26.5116C12.4583 27.4339 12.4583 28.5661 11.9312 29.4884L13.6677 30.4807C14.5461 28.9435 14.5461 27.0565 13.6677 25.5193L11.9312 26.5116ZM0.485007 6.48069L11.9312 26.5116L13.6677 25.5193L2.22149 5.48842L0.485007 6.48069ZM4.82622 55C2.52276 55 1.07865 52.5116 2.22149 50.5116L0.485007 49.5193C-1.41973 52.8526 0.98711 57 4.82622 57V55ZM238.934 52C238.934 53.6569 237.59 55 235.934 55V57C238.695 57 240.934 54.7614 240.934 52H238.934ZM4.82623 -1C0.987113 -1 -1.41973 3.14741 0.485007 6.48069L2.22149 5.48842C1.07865 3.48845 2.52276 1 4.82623 1V-1ZM235.934 1C237.59 1 238.934 2.34315 238.934 4H240.934C240.934 1.23858 238.695 -1 235.934 -1V1Z" fill="#DDDFE1" mask="url(#path-1-inside-1_752_147)"/>
        </svg>
      </div>

        <p class="text text-step-1">1. Choose and Upload two FASTQ files</p>
        <p class="text text-step-2">2. Execute two FASTQ files to CSV</p>
        <p class="text text-step-3">3. Output CSV file</p>

    </div>

    <h2 class="title head">Folder: {{ folder.name }}</h2>
    
    <!-- Display files -->
    <h2 class="title head">Upload files:</h2>
    <p class="title"><i>Upload 2 fastq.gz files</i></p>
    <ul>
      {% set sorted_subfiles = subfiles | sort(attribute='name') %}

      {% for subfile in sorted_subfiles %}

        {% if subfile.name.endswith('.gz') %}
          <div class="file-list name-file">
            <li>{{ subfile.name }}</li>
            <button type="button" class="close" onclick="deleteSubFile('{{ subfile.id }}','{{ subfile.folder_id }}')">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        {% endif %}
      {% endfor %}

    </ul>
  
 <!-- Create new file -->
 <form action="/folder/{{ folder.id }}" method="post" enctype="multipart/form-data" id="uploadForm">
  <div id="fileInputContainer">
	  {% if subfiles|length>=2 %}
      <button type="button" class="btn-primary btn execute-button" id="addFileBtn" onclick="executeF('{{ folder.id }}')">Analyze FastQ files</button>
    {% else %}
    <ul>
      {%if subfiles|length==0%}
      <div class="file-list box-list">
        <li><input type="file" id="inputFile1" name="inputFile1" accept=".txt, .fastq, .gz"></li>
      </div>
      <div class="file-list box-list">
        <li><input type="file" id="inputFile2" name="inputFile2" accept=".txt, .fastq, .gz"></li>
      </div>
      {%elif subfiles[0].name.endswith("_2.fastq.gz")%}
      <div class="file-list box-list">
        <li><input type="file" id="inputFile1" name="inputFile1" accept=".txt, .fastq, .gz"></li>
      </div>
      {%elif subfiles[0].name.endswith("_1.fastq.gz")%}
      <div class="file-list box-list">
        <li><input type="file" id="inputFile2" name="inputFile2" accept=".txt, .fastq, .gz"></li>
      </div>
      {%endif%}
    </ul>
      <button type="submit" class="btn btn-primary">Add File</button>
    {% endif %}
  </div>
</form>
  
    <!-- Display output files -->
    <div class="ouput-file">
      <h2 class="title head">Output:</h2>
      <p class="title"><i>The output will be a CSV file containing annotated genomic variations obtained by converting filtered VCF files to AVinput format.</i></p>
      <ul>
         {% for subfile in output %}
          {% if subfile.name.endswith('.csv') %}
            <div class="file-list name-file">
              <li><a href="{{ url_for('get_file', file_id=subfile.id) }}">{{ subfile.name }}</a></li>
              <button type="button" class="close" onclick="deleteSubFile('{{ subfile.id }}','{{ subfile.folder_id }}')">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
  </div>
{% endblock %}

