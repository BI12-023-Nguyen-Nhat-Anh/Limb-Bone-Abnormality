{% extends 'home.html' %}
{% block title %}Folder{% endblock %}
{% block content %}

  <div class="form">

        <div class="header">
          <ul class="ul">
              <li class="active step step1">
                  <div class="pipeline">

                  </div>
              </li>
              <li class="step step2">
                  <div class="pipeline">

                  </div>
              </li>
              <li class="step step3">
                  <div class="pipeline">

                  </div>
              </li>
          </ul>
      </div>
    <br>
    <h2>Folder: {{ folder.name }}</h2>
    
    <!-- Display files -->
    <h2>Input Files:</h2>
    <ul>
      {% set sorted_subfiles = subfiles | sort(attribute='name') %}
  
      {% for subfile in sorted_subfiles %}
        {% if subfile.name.endswith('.gz') %}
          <div class="file-list">
            <li>{{ subfile.name }}</li>
            <button type="button" class="close" onclick="deleteSubFile('{{ subfile.id }}','{{ subfile.folder_id }}')">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        {% endif %}
      {% endfor %}
    </ul>
  
 <!-- Create new file -->
 <form action="/folder/{{ folder.id }}" method="post" enctype="multipart/form-data" id="uploadForm">
  <div id="fileInputContainer">
	  {% if subfiles|length>=2 %}
      <button type="button" class="btn-primary btn execute-button" id="addFileBtn" onclick="executeF('{{ folder.id }}')">Execute</button>
    {% else %}
    <ul>
      {%if subfiles|length==0%}
      <div class="file-list">
        <li><input type="file" id="inputFile1" name="inputFile1" accept=".txt, .fastq, .gz"></li>
      </div>
      <div class="file-list">
        <li><input type="file" id="inputFile2" name="inputFile2" accept=".txt, .fastq, .gz"></li>
      </div>
      {%elif subfiles[0].name.endswith("_2.fastq.gz")%}
      <div class="file-list">
        <li><input type="file" id="inputFile1" name="inputFile1" accept=".txt, .fastq, .gz"></li>
      </div>
      {%elif subfiles[0].name.endswith("_1.fastq.gz")%}
      <div class="file-list">
        <li><input type="file" id="inputFile2" name="inputFile2" accept=".txt, .fastq, .gz"></li>
      </div>
      {%endif%}
    </ul>
      <button type="submit" class="btn btn-primary">Add File</button>
    {% endif %}
  </div>
</form>
  
    <!-- Display output files -->
    <div class="ouput-file">
      <h2>Output:</h2>
      <ul>
         {% for subfile in output %}
          {% if subfile.name.endswith('.csv') %}
            <div class="file-list">
              <li><a href="{{ url_for('get_file', file_id=subfile.id) }}">{{ subfile.name }}</a></li>
              <button type="button" class="close" onclick="deleteSubFile('{{ subfile.id }}','{{ subfile.folder_id }}')">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
  </div>

{% endblock %}

